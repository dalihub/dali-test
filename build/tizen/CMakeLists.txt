CMAKE_MINIMUM_REQUIRED(VERSION 3.8.2)
PROJECT(dali-test C CXX)

SET(CMAKE_CXX_STANDARD 17)

SET(dali-test_VERSION_MAJOR 1)
SET(dali-test_VERSION_MINOR 0)

SET(ROOT_SRC_DIR ${CMAKE_SOURCE_DIR}/../..)

SET(PREFIX ${CMAKE_INSTALL_PREFIX})

SET(BINDIR ${PREFIX}/bin)
SET(APP_DATA_RES_DIR ${PREFIX}/share/dali-test/res)

MESSAGE( STATUS "CMAKE_BUILD_TYPE: " ${CMAKE_BUILD_TYPE} )
if(CMAKE_BUILD_TYPE MATCHES Debug)
    MESSAGE("Setting variable: DEBUG_ENABLED")
    SET(DEBUG_ENABLED "1")
ENDIF()

SET(IMAGES_DIR ${APP_DATA_RES_DIR}/images/)
SET(SCENES_DIR ${APP_DATA_RES_DIR}/scenes/)

SET(TEST_IMAGE_DIR \\"${IMAGES_DIR}\\")
SET(TEST_SCENE_DIR \\"${SCENES_DIR}\\")

INCLUDE(FindPkgConfig)

SET(OPENCV opencv)

PKG_CHECK_MODULES(OPENCV_PKG QUIET ${OPENCV})

IF(NOT OPENCV_PKG_FOUND)
  SET(OPENCV opencv4 )
ENDIF()

SET(PKG_LIST dali2-core
             dali2-adaptor
             dali2-toolkit
             dali2-scene-loader
             ${OPENCV})

PKG_CHECK_MODULES(REQUIRED_PKGS REQUIRED ${PKG_LIST})

FOREACH(flag ${REQUIRED_PKGS_CFLAGS})
  SET(REQUIRED_CFLAGS "${REQUIRED_CFLAGS} ${flag}")
ENDFOREACH(flag)

SET(DALI_TEST_CFLAGS "-DTEST_IMAGE_DIR=${TEST_IMAGE_DIR} -DTEST_SCENE_DIR=${TEST_SCENE_DIR} -DTEST_BIN=${TEST_BIN} -fvisibility=hidden -DHIDE_DALI_INTERNALS")

IF(DEFINED DEBUG_ENABLED)
  SET(DALI_TEST_CFLAGS "${DALI_TEST_CFLAGS} -DDEBUG_ENABLED")
ENDIF()

SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${REQUIRED_CFLAGS} ${DALI_TEST_CFLAGS} -Werror -Wall -fPIE")
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${CMAKE_C_FLAGS}")

INCLUDE_DIRECTORIES(${ROOT_SRC_DIR}/common)

ADD_SUBDIRECTORY(visual-tests)
